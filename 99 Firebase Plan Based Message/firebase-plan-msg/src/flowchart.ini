App.jsx

         ┌───────────────┐
         │   App starts  │
         └───────┬───────┘
                 │
                 ▼
       ┌──────────────────┐
       │ Check Firebase   │
       │ auth state (uid) │
       └───────┬─────────┘
               │
   ┌───────────┼───────────┐
   │                           │
   ▼                           ▼
┌─────────────┐        ┌─────────────────┐
│ No user UID │        │ User UID exists │
└───────┬─────┘        └─────────┬──────┘
        │                        │
        ▼                        ▼
┌───────────────────┐     ┌─────────────────────┐
│ Show <Auth />     │     │ Generate chatId     │
│ (login/signup UI) │     │ (uid + chatWith)    │
└─────────┬─────────┘     └───────────┬─────────┘
          │                           │
          ▼                           ▼
   (User logs in)              ┌─────────────────┐
          ───────────────────▶ │ Show <ChatRoom> │
                               │ with chatId     │
                               └─────────────────┘

Auth.jsx

                 ┌───────────────────┐
                 │   User enters     │
                 │ email + password  │
                 │ + plan (Free/Pro) │
                 └─────────┬─────────┘
                           │
          ┌────────────────┼────────────────┐
          │                                 │
          ▼                                 ▼
   ┌───────────────┐                ┌───────────────┐
   │ Click Register │                │   Click Login │
   └───────┬───────┘                └───────┬───────┘
           │                                │
           ▼                                ▼
 ┌────────────────────┐            ┌─────────────────────┐
 │ createUserWith...  │            │ signInWith...       │
 │ (Firebase Auth)    │            │ (Firebase Auth)     │
 └─────────┬──────────┘            └─────────┬───────────┘
           │                                │
           ▼                                ▼
┌───────────────────────┐         ┌────────────────────────┐
│ Firestore: create doc │         │ Firestore: check usage │
│ "usage/{uid}"         │         │ doc, create if missing │
│ {plan, counts=0}      │         │ {plan:"free", counts=0}│
└─────────┬─────────────┘         └─────────┬──────────────┘
          │                                 │
          ▼                                 ▼
 ┌───────────────────────┐         ┌───────────────────────┐
 │ Call onAuth(uid)      │         │ Call onAuth(uid)      │
 │ → Notify App.jsx      │         │ → Notify App.jsx      │
 └───────────────────────┘         └───────────────────────┘


ChatRoom.jsx


              ┌───────────────────────────┐
              │        ChatRoom.jsx        │
              └─────────────┬─────────────┘
                            │
        ┌───────────────────┼────────────────────┐
        │                                        │
        ▼                                        ▼
┌─────────────────────┐                ┌──────────────────────┐
│  Listen to messages │                │   Send a message     │
│  (onSnapshot)       │                │   (button click)     │
└─────────┬───────────┘                └─────────┬────────────┘
          │                                      │
          ▼                                      ▼
 ┌────────────────────────┐              ┌───────────────────────────┐
 │ Get messages from      │              │ Start Firestore transaction│
 │ chats/{chatId}/messages│              └─────────┬─────────────────┘
 └─────────┬──────────────┘                        │
           │                                       ▼
           ▼                             ┌───────────────────────────┐
 ┌────────────────────────┐              │ Check writeCount + plan   │
 │ Show in chat window    │              │ (Free = 5, Pro = 20/day)  │
 └─────────┬──────────────┘              └─────────┬─────────────────┘
           │                                       │
           ▼                                       ▼
 ┌────────────────────────┐              ┌───────────────────────────┐
 │ Increment readCount    │              │ If limit not reached:     │
 │ in usage/{uid} doc     │              │   - Add message to Firestore│
 └─────────┬──────────────┘              │   - Increment writeCount   │
           │                             └─────────┬─────────────────┘
           ▼                                       │
 ┌────────────────────────┐                        ▼
 │ If over read limit →   │                ┌───────────────────────────┐
 │ show errorMsg          │                │ If over write limit →     │
 └────────────────────────┘                │ show errorMsg             │
                                           └───────────────────────────┘


Full App Flow Diagram

                     ┌───────────────────────────┐
                     │         App.jsx           │
                     └─────────────┬─────────────┘
                                   │
                                   ▼
                    ┌─────────────────────────────┐
                    │  Check Firebase Auth state  │
                    └─────────────┬───────────────┘
                                  │
                 ┌────────────────┼───────────────────┐
                 │                                    │
                 ▼                                    ▼
        ┌──────────────────┐               ┌──────────────────┐
        │ No user logged in │               │ User is logged in│
        └─────────┬────────┘               └──────────┬───────┘
                  │                                   │
                  ▼                                   ▼
        ┌──────────────────────┐            ┌──────────────────────┐
        │ Show <Auth />        │            │ Generate chatId      │
        │ (login/register form)│            │ (uid + other user)   │
        └─────────┬────────────┘            └──────────┬───────────┘
                  │                                   │
                  ▼                                   ▼
       ┌─────────────────────┐            ┌────────────────────────┐
       │       Auth.jsx      │            │     Show <ChatRoom />  │
       └─────────┬───────────┘            │   with that chatId     │
                 │                        └───────────┬────────────┘
   ┌─────────────┼─────────────────────┐              │
   │                                   │              │
   ▼                                   ▼              ▼
┌─────────────┐               ┌──────────────────┐   ┌─────────────────────┐
│ Register    │               │ Login            │   │     ChatRoom.jsx     │
└─────┬───────┘               └───────┬──────────┘   └──────────┬──────────┘
      │                               │                         │
      ▼                               ▼                         │
┌──────────────┐            ┌────────────────────┐              │
│ Firebase Auth│            │ Firebase Auth      │              │
│ create user  │            │ sign in user       │              │
└─────┬────────┘            └──────────┬─────────┘              │
      │                                │                        │
      ▼                                ▼                        ▼
┌───────────────────────┐    ┌────────────────────────┐  ┌─────────────────────────┐
│ Firestore usage/{uid} │    │ Ensure usage/{uid} doc │  │ Real-time listener on   │
│ created with plan+0s  │    │ exists, create if not  │  │ chats/{chatId}/messages │
└──────────┬────────────┘    └──────────┬─────────────┘  └───────────┬────────────┘
           │                             │                           │
           ▼                             ▼                           ▼
 ┌─────────────────────┐      ┌─────────────────────┐      ┌──────────────────────┐
 │ Call onAuth(uid)    │      │ Call onAuth(uid)    │      │ On new message →     │
 │ → back to App.jsx   │      │ → back to App.jsx   │      │ increment readCount   │
 └─────────────────────┘      └─────────────────────┘      └──────────────────────┘
                                                                  │
                                                                  ▼
                                                 ┌───────────────────────────┐
                                                 │ Send Message button:      │
                                                 │ - Check writeCount + plan │
                                                 │ - If under limit → send   │
                                                 │ - Else → show error       │
                                                 └───────────────────────────┘


